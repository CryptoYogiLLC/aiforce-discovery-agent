{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aiforce-discovery-agent/schemas/discovered-server.json",
  "title": "Server Discovered Event",
  "description": "Event emitted when a server/host is discovered on the network",
  "allOf": [{ "$ref": "cloudevent-base.json" }],
  "properties": {
    "type": {
      "const": "discovery.server.discovered"
    },
    "source": {
      "const": "/collectors/network-scanner"
    },
    "data": {
      "type": "object",
      "required": ["server_id", "ip_addresses"],
      "properties": {
        "server_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for this server discovery"
        },
        "hostname": {
          "type": "string",
          "description": "Resolved hostname (if available)"
        },
        "ip_addresses": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "ipv4"
          },
          "minItems": 1,
          "description": "IP addresses associated with this server"
        },
        "mac_address": {
          "type": "string",
          "pattern": "^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$",
          "description": "MAC address (if on same subnet)"
        },
        "open_ports": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1,
            "maximum": 65535
          },
          "description": "List of open ports discovered on the server"
        },
        "os": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "description": "Operating system name"
            },
            "version": {
              "type": "string",
              "description": "Operating system version"
            },
            "family": {
              "type": "string",
              "enum": ["linux", "windows", "macos", "unix", "unknown"],
              "description": "Operating system family"
            }
          },
          "description": "Operating system information from fingerprinting"
        },
        "metadata": {
          "type": "object",
          "description": "Additional metadata (cloud_provider, hosting_model for Phase 1)",
          "properties": {
            "cloud_provider": {
              "type": "string",
              "enum": ["aws", "azure", "gcp", "other", "none"],
              "description": "Inferred cloud provider from IP range (Phase 1)"
            },
            "hosting_model": {
              "type": "string",
              "enum": ["cloud", "on_premises", "hybrid", "unknown"],
              "description": "Inferred hosting model (Phase 1)"
            }
          }
        }
      }
    }
  }
}
